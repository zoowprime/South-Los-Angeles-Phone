import{a as e,aj as be,r as l,G as oe,q as L,s as m,j as a,x as Ue,L as i,co as ze,ca as Z,V as le,C as W,cC as De,a0 as de,m as re,cD as Fe,O as Pe,I as ve,ax as je,cc as ye,o as Ie,ae as pe,a6 as we,K as Se,cr as Re,cE as Ve,aX as Ne,R as Oe,ab as Ke,F as Q,d as ue,a7 as Je,a1 as Xe,cq as Me,u as fe,A as ge,cs as xe,cF as Qe,cG as Ge,bT as et,a5 as tt,P as ce,U as Be,S as We,b as he,t as ie,cH as nt,cI as it,cJ as st,ck as at,aB as Ee,an as ot,ao as lt,b0 as He,bW as rt,aD as ct,a9 as dt,bN as ut,cf as mt,bV as ft,cg as ht,cy as Le,cK as vt,bQ as Tt,cL as Pt,cM as gt,cw as pt,b8 as St,aa as Ct}from"./index-a04bc7c5.js";import{T as $e}from"./Textarea-63971279.js";import{S as It}from"./Switch-1ce279b8.js";import{S as Nt}from"./Slider-ce3bd25e.js";function me(){return e("div",{className:"checkmark",children:e(be,{})})}const $={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Ze(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function Ot(){var y;const{User:t}=l.useContext(B),[f]=t,[h,P]=l.useState(""),[N,T]=l.useState(""),[d,r]=l.useState([]),[o,g]=l.useState([]),[n,s]=l.useState(0),[u,b]=l.useState(!1),[V,U]=l.useState(0),[c,S]=l.useState(!1),[v,D]=l.useState(!1);l.useEffect(()=>{oe("TikTok")&&L("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},$.Videos).then(K=>{if(!K)return m("warning","Failed to get videos");g(K)})},[]),l.useEffect(()=>{h.length>0&&L("TikTok",{action:"searchAccounts",query:h},$.Accounts.filter(K=>K.username.includes(h))).then(K=>{if(!K)return m("info","No response, most likely no accounts to search for?");r(K)}),U(0),D(!1)},[h]),l.useEffect(()=>{const K=setTimeout(()=>P(N),500);return()=>clearTimeout(K)},[N]);const F=()=>{let K=h.length===0;if(K&&u)return m("info","Fetched everything, no need to fetch more (VIDEOS)");if(!K&&v)return m("info","Fetched everything, no need to fetch more (SEARCH)");if(c)return m("info","Already fetching");let O=document.querySelector("#last");if(!O)return m("warning","No last element");!ze(O)&&(S(!0),L("TikTok",{action:K?"getVideos":"searchAccounts",query:h,data:{full:!0,type:"recent"},page:(K?n:V)+1},null).then(w=>{w&&w.length>0?(K?g(I=>[...I,...w]):r(I=>[...I,...w]),S(!1)):(S(!1),K?b(!0):D(!0))}),K?s(w=>w+1):U(w=>w+1))};return a("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Ue,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:K=>T(K.target.value)})}),h.length>0?e("div",{className:"search-results",onScroll:F,children:(y=d==null?void 0:d.filter(K=>K.username!==f.username))==null?void 0:y.map((K,O)=>e(wt,{data:K,last:d.length-1===O},O))}):e("div",{className:"discover-content",onScroll:F,children:o.map((K,O)=>e(At,{data:K,last:o.length-1===O},O))})]})}const wt=({data:t,last:f})=>{var g,n;const{Func:h,GoBack:P}=l.useContext(B),[N,T]=P,[d,r]=l.useState(t.isFollowing),o=s=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:s}},!0).then(u=>{if(!u||!(u!=null&&u.success))return m("warning","Failed to toggle follow");if(u.error)return m("error",u.error);r(s)})};return a("div",{className:"item",id:f?"last":"",onClick:()=>{T({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),a("div",{className:"stats",children:[Y(t.follower_count)??"0"," ",(g=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:g.toLowerCase()," ",Y(t.video_count)??"0"," ",(n=i("APPS.TIKTOK.VIDEOS"))==null?void 0:n.toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:le("button",d?"following":"follow"),onClick:s=>{s.stopPropagation(),d?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>o(!1)}]}):o(!0)},children:d?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})},At=({data:t,last:f})=>{const{Func:h,GoBack:P}=l.useContext(B),[N,T]=P;return a("div",{className:"item",id:f?"last":"",onClick:()=>{h.fetchAndSetVideo(t.id,{type:"recent"}),T({view:"discover"})},children:[a("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:d=>{var r;return(r=d.currentTarget)==null?void 0:r.play().catch(()=>{})},onMouseLeave:d=>{var r;return(r=d.currentTarget)==null?void 0:r.pause()},muted:!0}),e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),a("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),a("div",{className:"video-info",children:[a("div",{className:"user",onClick:d=>{d.stopPropagation(),T({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[e(Z,{avatar:t.avatar}),e("div",{className:"name",children:t.username})]}),a("div",{className:"stats",children:[a("div",{children:[e(De,{className:"plays"}),Y(t.views)]}),a("div",{children:[e(Ze,{}),Y(t.likes)]})]})]})]})]})};function kt(){const{User:t,View:f,Dm:h}=l.useContext(B),[P,N]=f,[T,d]=h,[r,o]=l.useState(!1),[g,n]=l.useState([]);return l.useEffect(()=>{oe("TikTok")&&L("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(s=>{if(!(s!=null&&s.success))return m("warning",s.error);n(s.channels)})},[]),de("tiktok:receivedMessage",s=>{n(u=>{let b=u.findIndex(U=>U.channelId===s.channelId);if(b===-1)return u;let V=[...u];return V[b].lastMessage=s.content,V[b].lastMessageTimestamp=Date.now(),V})}),a(re.div,{...Fe,className:"messages-container",children:[e(Pe,{children:r&&e(Kt,{close:()=>o(!1)})}),a("div",{className:"dmmessages-header",children:[e(ve,{onClick:()=>N("inbox")}),e("div",{className:"title",children:i("APPS.TIKTOK.DIRECT_MESSAGES")}),e(je,{onClick:()=>o(!0)})]}),a("div",{className:"messages-body",children:[g.length===0&&a("div",{className:"no-messages",children:[e(ye,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),g.map((s,u)=>a("div",{className:"message","data-unread":s.unread_messages>0,onClick:()=>{d({id:s.id,name:s.name,username:s.username,avatar:s.avatar,verified:s.verified,follower_count:s.follower_count,following_count:s.following_count,video_count:s.video_count}),s.unread_messages>0&&L("TikTok",{action:"clearUnreadMessages",id:s.id}),N("dm")},children:[a("div",{className:"user",children:[e(Z,{avatar:s.avatar}),a("div",{className:"message-content",children:[e("div",{className:"username",children:s.name}),e("div",{className:"content",children:s.last_message})]})]}),e("div",{className:"timestamp",children:Ie(s.timestamp)})]},u))]})]})}const Kt=({close:t})=>{const{User:f}=l.useContext(B),[h]=f,[P,N]=l.useState(""),[T,d]=l.useState(""),[r,o]=l.useState([]);l.useEffect(()=>{const n=setTimeout(()=>N(T),500);return()=>clearTimeout(n)},[T]),l.useEffect(()=>{P.length>0&&L("TikTok",{action:"searchAccounts",query:P},{success:!0,accounts:$.Accounts}).then(n=>{if(!n)return m("info","No response, most likely no accounts to search for?");o(n)})},[P]);const g=n=>{};return a(re.div,{...pe,className:"search-container",children:[a("div",{className:"search-header",children:[e(we,{onClick:t}),e(Ue,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>d(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:g,children:r==null?void 0:r.filter(n=>n.username!==h.username).map((n,s)=>e(Et,{data:n,last:r.length-1===s},s))})]})},Et=({data:t,last:f})=>{var o,g;const{View:h,Dm:P}=l.useContext(B),[N,T]=h,[d,r]=P;return e("div",{className:"item",id:f?"last":"",onClick:()=>{r({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),T("dm")},children:a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),a("div",{className:"stats",children:[Y(t.follower_count)," ",(o=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:o.toLowerCase()," ",Y(t.video_count)??"0"," ",(g=i("APPS.TIKTOK.VIDEOS"))==null?void 0:g.toLowerCase()]})]})]})})};function Ye({className:t}){return a("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Ae({className:t}){return a("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function Lt(){const{View:t}=l.useContext(B),[f,h]=t,[P,N]=l.useState([]),[T,d]=l.useState(0);l.useEffect(()=>{oe("TikTok")&&(L("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(o=>{if(!o.success)return m("warning","Failed to get unread messages: "+o.error);d(o==null?void 0:o.unread)}),L("TikTok",{action:"getNotifications",page:0},{success:!0,data:$.Notifications}).then(o=>{if(!o.success)return m("warning","Failed to get notifications: "+o.error);N(o.data)}))},[]);const{handleScroll:r}=Se({fetchData:o=>L("TikTok",{action:"getNotifications",page:o}),onDataFetched:o=>()=>{if(!(o!=null&&o.success))return m("warning","Failed to get notifications: "+o.error);if(!(o!=null&&o.data))return m("warning","Failed to get notifications: (NO DATA)"+(o==null?void 0:o.error));N([...P,...o.data])},perPage:25});return a("div",{className:"inbox-container",children:[a("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:i("APPS.TIKTOK.ALL_ACTIVITY")}),a("div",{className:"messages",onClick:()=>h("messages"),children:[e(Re,{}),T>0&&e("div",{className:"notifications",children:T})]})]}),a("div",{className:"inbox-body",onScroll:r,children:[P.length===0&&a("div",{className:"no-notifications",children:[e(Ve,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),P.map((o,g)=>e(_t,{data:o},g))]})]})}const _t=({data:t})=>{const{Func:f,GoBack:h}=l.useContext(B),[P,N]=h,[T,d]=l.useState(t.isFollowing),r=n=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},{success:!0}).then(s=>{if(!s||!(s!=null&&s.success))return m("warning","Failed to toggle follow");if(s.error)return m("error",s.error);d(n)})};let o;switch(t.type){case"follow":o=i("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":o=i("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":o=i("APPS.TIKTOK.LIKED_COMMENT");break;case"save":o=i("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":o=i("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":o=i("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const g=()=>{N({view:"inbox"}),f.fetchAndSetProfile(t.username)};return a("div",{className:le("notification",t.type),children:[a("div",{className:"user",children:[a("div",{className:"avatar",onClick:g,children:[e(Z,{avatar:t.avatar}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Ae,{}):e(Ye,{})})]}),a("div",{className:"info",children:[a("div",{className:"username",onClick:g,children:[t.name,t.verified&&e(me,{})]}),a("div",{className:"notification-content",children:[o,e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&a("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:le("button",T?"following":"follow"),onClick:n=>{n.stopPropagation(),T?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:T?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(N({view:"inbox"}),f.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function bt(){var I,_;const{User:t,GoBack:f,View:h,Func:P,Dm:N,Profile:T}=l.useContext(B),[d,r]=t,[o,g]=h,[n]=N,[s,u]=f,[b,V]=T,[U,c]=l.useState([]),[S,v]=l.useState(n==null?void 0:n.id),D=l.useRef(null),[F,y]=l.useState("");l.useState(0),l.useState(!1),l.useState(!1),l.useEffect(()=>(Ne.ReceiveAppNotifications.set(!1),()=>{Ne.ReceiveAppNotifications.set(!0)}),[]),l.useEffect(()=>{var p;S&&L("TikTok",{action:"getMessages",page:0,id:S},{success:!0,messages:(p=$.Messages.find(k=>k.id===S))==null?void 0:p.messages}).then(k=>{if(!(k!=null&&k.success))return m("warning","An error occured while fetching messages. "+(k==null?void 0:k.error));if(!(k!=null&&k.messages))return m("warning","An error occured while fetching messages. (No messages)");c(k.messages.reverse())})},[S]),de("tiktok:receivedMessage",p=>{n.username===p.sender&&c([...U,{...p,timestamp:new Date().getTime()}])});const K=()=>{var p;if(F.trim().length===0)return m("warning","You can't send an empty message");L("TikTok",{action:"sendMessage",data:{id:S,username:n.username,content:F}},{success:!0,id:"3",channelId:(p=$.Messages.find(k=>k.id===S))==null?void 0:p.id}).then(k=>{if(!(k!=null&&k.success))return m("warning","An error occured while sending message. "+(k==null?void 0:k.error));m("info",`Message sent to ${n.username}, id: ${k.id}, channelId: ${k==null?void 0:k.channelId}`),k!=null&&k.channelId&&!S&&v(k.channelId),D.current.value="",c([...U,{id:k.id,sender:d.username,recipient:n.username,content:F,timestamp:new Date().getTime()}]),y("");let x=document.querySelector(".dm-body");x.scrollTop=x.scrollHeight})},{handleScroll:O}=Se({fetchData:p=>L("TikTok",{action:"getMessages",username:n.username,page:p}),onDataFetched:p=>c([...p.reverse(),...U]),isReversed:!0,perPage:25}),E=p=>{if(p)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(p)},w=p=>{P.fetchAndSetVideo(p,{single:!0}),u({view:"dm"})};return a(re.div,{...Fe,className:"dm-container",children:[a("div",{className:"dm-header",children:[e(ve,{onClick:()=>{s!=null&&s.view?(s.data&&s.data.identifier==="profile"&&V(s.data.data),g(s.view),u(null)):g("messages")},className:"chevron"}),a("div",{className:"profile",onClick:p=>{p.stopPropagation(),u({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e(Z,{avatar:n.avatar})}),a("div",{className:"username",children:[n.name??n.username,n.verified&&e(me,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:O,children:a("div",{className:"dm-body",children:[a("div",{className:"messages-hero","data-nomessages":U.length===0,children:[e(Z,{className:"avatar",avatar:n.avatar}),e("div",{className:"name",children:n.name}),a("div",{className:"secondary",children:[a("div",{className:"username",children:["@",n.username]}),a("div",{className:"stats",children:[a("div",{className:"following",children:[Y(n.following_count)," ",(I=i("APPS.TIKTOK.FOLLOWING"))==null?void 0:I.toLowerCase()]}),a("div",{className:"followers",children:[Y(n.follower_count)," ",(_=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:_.toLowerCase()]})]})]})]}),U.map((p,k)=>{var z;let x,q=p.sender===d.username?"self":"other",ee=((z=U[k+1])==null?void 0:z.sender)===d.username?"self":"other";return U[k+1]?x=Math.abs(p.timestamp-U[k+1].timestamp)/36e5:ee=void 0,p.content&&E(p.content)&&(p.video=p.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],p.videoId=p.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),a("div",{className:le("message",q),children:[q=="other"?a("div",{className:"message-with-pfp",children:[e("div",{className:le("profile-picture",q!==ee?"show":"hide"),onClick:se=>{se.stopPropagation(),u({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:e(Z,{avatar:n.avatar})}),e("div",{className:"message-content",children:p.video?a("div",{className:"shared-video",onClick:()=>w(p.videoId),children:[e("video",{src:p.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(p.content)})})]}):e(Q,{children:p.video?a("div",{className:"shared-video",onClick:()=>w(p.videoId),children:[e("video",{src:p.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(p.content)})}),U[k+1]&&x>6?e("div",{className:"date",children:Ie(p.timestamp)}):q!==ee&&e("div",{className:"date",children:Ie(p.timestamp)})]},k)})]})}),e("div",{className:"dm-footer",children:a("div",{className:"input",children:[e(ue,{type:"text",placeholder:i("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:D,onChange:p=>y(p.target.value),onKeyDown:p=>{p.key==="Enter"&&K()}}),e("div",{className:"buttons",children:F.trim().length>0&&e("div",{className:"send",onClick:K,children:e(Je,{})})})]})})]})}function Ut(){return a("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function Dt({id:t,commentCount:f,username:h,close:P}){const{User:N}=l.useContext(B),[T]=N,[d,r]=l.useState([]),[o,g]=l.useState(""),[n,s]=l.useState(null),u=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{var c;oe("TikTok")&&L("TikTok",{action:"getComments",page:0,data:{id:t,creator:h}},{success:!0,comments:(c=$.Videos.find(S=>S.id===t))==null?void 0:c.commentsData}).then(S=>{if(!(S!=null&&S.success))return m("warning",S.error);r(S.comments)})},[]);const V=()=>{if(o.trim().length===0)return m("warning","Comment is empty");let c=n!=null&&n.isReplyToReply?`@${n.name} ${o}`:o;L("TikTok",{action:"postComment",data:{id:t,comment:c,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(S=>{if(!(S!=null&&S.success))return m("warning",S.error);r(n?v=>v.map(D=>D.id==n.id?{...D,reply_count:D!=null&&D.reply_count?D.reply_count+1:1,replies:[{id:S.id,username:T.username,avatar:T.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:T.verified},...(D==null?void 0:D.replies)||[]]}:D):v=>[{id:S.id,username:T.username,avatar:T.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:T.verified},...v]),g(""),b.current.style.height="auto",s(null)})},{handleScroll:U}=Se({fetchData:c=>L("TikTok",{action:"getComments",data:{id:t,creator:h},page:c}),onDataFetched:c=>r(S=>[...S,...(c==null?void 0:c.comments)??[]]),perPage:15});return l.useEffect(()=>{const c=S=>{const v=u.current;v.scrollTo({top:v.scrollTop+S.deltaY,behavior:"smooth"})};return u.current&&u.current.addEventListener("wheel",c),()=>{u.current&&u.current.removeEventListener("wheel",c)}},[u]),e("div",{className:"comments-container",onClick:()=>P(),children:a(re.div,{...pe,className:"comments-wrapper",onClick:c=>c.stopPropagation(),children:[a("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:i("APPS.TIKTOK.COMMENTS_TITLE").format({count:f})}),e("div",{className:"close",children:e(we,{onClick:P})})]}),e("div",{className:"comments-body",ref:u,onScroll:U,children:d.map((c,S)=>e(qe,{comment:c,videoId:t,username:h,remove:()=>r(v=>v.filter(D=>D.id!=c.id)),setReplyTo:s},c.id))}),a("div",{className:"comments-footer",children:[e(Z,{avatar:T.avatar}),a("div",{className:"input",children:[e(ue,{maxLength:300,ref:b,value:o,onChange:c=>{g(c.target.value);let S=c.target.scrollHeight;c.target.style.height=S+"px"},onKeyDown:c=>{c.key=="Enter"&&V(),c.key==" "&&g(S=>S+" ")},placeholder:n?i("APPS.TIKTOK.REPLY_TO").format({name:n.name}):i("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{W.Emoji.set({onSelect:c=>g(S=>S+c.emoji)})},children:e(Ut,{})}),o.trim().length>0&&e("span",{children:e(ye,{onClick:V})})]})]})]})})}const qe=({videoId:t,username:f,comment:h,remove:P,setReplyTo:N})=>{var y,K,O;const{User:T}=l.useContext(B),[d]=T,[r,o]=l.useState(h),[g,n]=l.useState(r.likes),[s,u]=l.useState(r.liked===1),[b,V]=l.useState(r.creator_liked===1);l.useState(0),l.useState(!1),l.useState(!1);const[U,c]=l.useState(!1);l.useEffect(()=>{h&&o(h)},[h]);const S=()=>{L("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:f}},null).then(E=>{if(!(E!=null&&E.success))return m("warning",E.error);o(w=>({...w,replies:[...(w==null?void 0:w.replies)??[],...E.comments.filter(I=>w!=null&&w.replies?!w.replies.some(_=>_.id===I.id):!0)]})),c(!0)})},v=()=>{L("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!s},{success:!0}).then(E=>{if(!(E!=null&&E.success))return m("warning",E.error);d.username===f&&V(w=>!w),u(w=>!w),o(w=>({...w,liked:!w.liked}))})};de("tiktok:updateCommentLikes",E=>{E.id===r.id&&n(w=>E.method==="add"?w+1:w-1)});let D=r.username!==d.username||f!==r.username||d.isAdmin;const F=Xe(E=>{if(E.stopPropagation(),E.preventDefault(),!D)return m("warning","You cannot click to this comment!");let w=[(d.isAdmin||d.username===r.username)&&{title:i("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{L("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(I=>{if(!(I!=null&&I.success))return m("warning",I.error);P()})}}];W.ContextMenu.set({buttons:w})});return a("div",{className:"item","data-clickable":D,"data-id":r.id,children:[a("div",{className:"comment-info",...F,children:[e("div",{className:"avatar",children:e(Z,{avatar:r.avatar})}),a("div",{className:"comment-data",children:[a("div",{className:"username",children:[r.username,r.verified&&e(me,{}),r.username===f&&e("div",{className:"creator-badge",children:i("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),a("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ce(r.timestamp)}),e("div",{className:"reply",onClick:()=>{N(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:i("APPS.TIKTOK.REPLY")})]}),b&&e("div",{className:"creator-liked",children:i("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&a("div",{className:"replies",children:[(y=r.replies)==null?void 0:y.map(E=>e(qe,{videoId:t,username:f,comment:{...E,replyTo:r.id},remove:()=>{o(w=>{var I;return{...w,reply_count:w.reply_count-1,replies:(I=w.replies)==null?void 0:I.filter(_=>_.id!==E.id)}})},setReplyTo:N})),!U&&((K=r.replies)==null?void 0:K.length)!==r.reply_count&&a("div",{className:"view-replies",onClick:S,children:[i("APPS.TIKTOK.VIEW_REPLIES")," ",a("b",{children:["(",r!=null&&r.replies?r.reply_count-(((O=r.replies)==null?void 0:O.length)??0):r.reply_count,")"]})," ",e(Me,{})]})]}),a("div",{className:"likes","data-active":s,onClick:v,children:[s?e(Ae,{}):e(Ze,{}),Y(g)]})]})};function Ft({className:t}){return a("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:a("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function ke({data:t,active:f,preview:h}){var X,ae,ne;const{User:P,Func:N,ShareComponent:T,GoBack:d}=l.useContext(B),r=fe(ce.Settings),[o]=P,[g,n]=T,[s,u]=l.useState(t==null?void 0:t.liked),[b,V]=l.useState(t==null?void 0:t.saved),[U,c]=l.useState(t==null?void 0:t.viewed),[S,v]=l.useState(t==null?void 0:t.likes),[D,F]=l.useState(t==null?void 0:t.saves),[y,K]=l.useState(t==null?void 0:t.comments),[O,E]=l.useState(!1),w=l.useRef(null),I=l.useRef(null),_=l.useRef(null),p=l.useRef(0),[k,x]=l.useState(!1),[q,ee]=l.useState(!1),z=fe(Be),se=fe(ge),M=fe(Ne.LockScreenVisible);l.useEffect(()=>{var C,G;return f&&((C=t.music)!=null&&C.path&&te(),(G=t.metadata)!=null&&G.tts&&H(),ee(!1)),()=>{I!=null&&I.current&&I.current.pause(),_!=null&&_.current&&_.current.pause(),!U&&f&&L("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{c(!0)})}},[f]),l.useEffect(()=>{var C,G,j;z!=null&&z.visible||!oe("TikTok")||M?(ee(!0),I!=null&&I.current&&I.current.pause(),_!=null&&_.current&&_.current.pause()):((j=(G=(C=ge)==null?void 0:C.value)==null?void 0:G.active)==null?void 0:j.name)==="TikTok"&&(ee(!1),I!=null&&I.current&&I.current.play().catch(()=>m("warning","TTS failed to play")),_!=null&&_.current&&_.current.play().catch(()=>m("warning","Music failed to play")))},[z==null?void 0:z.visible,se==null?void 0:se.active,M]);const H=()=>{var j,Te;if(!t.metadata.ttsUrl)return;I!=null&&I.current&&(I.current.pause(),I.current=null);const C=new Audio;C.src=t.metadata.ttsUrl;let G=((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?(Te=r==null?void 0:r.sound)==null?void 0:Te.volume:.5;C.volume=G/2,C.play().catch(()=>m("warning","TTS failed to play")),I.current=C},te=()=>{var G,j;const C=new Audio;_!=null&&_.current&&(_.current.pause(),_.current=null),C.src=(G=t.music.path)!=null&&G.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,C.volume=t.music.volume*(((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?r.sound.volume:.5),C.play().catch(()=>m("warning","Music failed to play")),_.current=C};l.useEffect(()=>{var C,G,j,Te;(C=r==null?void 0:r.sound)!=null&&C.volume&&(w.current&&(w.current.volume=((G=r==null?void 0:r.sound)==null?void 0:G.volume)!==void 0?r.sound.volume:.5),_!=null&&_.current&&(_.current.volume=t.music.volume*(((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?r.sound.volume:.5)),I!=null&&I.current&&(I.current.volume=(((Te=r==null?void 0:r.sound)==null?void 0:Te.volume)!==void 0?r.sound.volume:.5)/2))},[(X=r==null?void 0:r.sound)==null?void 0:X.volume]);const J=()=>{h||L("TikTok",{action:"toggleLike",id:t.id,toggle:!s},{success:!0}).then(C=>{if(!C.success)return m("warning",C.error);u(!s)})},A=()=>{h||-L("TikTok",{action:"toggleSave",id:t.id,toggle:!b},{success:!0}).then(C=>{if(!C.success)return m("warning",C.error);V(!b)})};de("tiktok:updateLikes",C=>{if(C&&C.id===t.id)return v(G=>G+(C.method==="add"?1:-1))}),de("tiktok:updateSaves",C=>{if(C&&C.id===t.id)return F(G=>G+(C.method==="add"?1:-1))}),de("tiktok:updateComments",C=>{if(C&&C.id===t.id)return K(G=>(C.count=C.count??1,G+(C.method==="add"?C.count:-C.count)))});const R=C=>{if(C.detail===1)return ee(!q);if(C.detail===2){if(!t.id)return;s||(J(),x(!0),setTimeout(()=>{x(!1)},1e3))}};return l.useEffect(()=>{const C=document.querySelector('.video[data-active="true"] video');if(!C)return m("warning","Video not found");q?(C.pause(),I!=null&&I.current&&I.current.pause(),_!=null&&_.current&&_.current.pause(),m("info","paused everything")):(C.play().catch(()=>m("warning","Video failed to play")),I!=null&&I.current&&I.current.play().catch(()=>m("warning","TTS failed to play")),_!=null&&_.current&&_.current.play().catch(()=>m("warning","Music failed to play")),m("info","playing everything"))},[q]),a(Q,{children:[e(Pe,{children:O&&!h&&e(Dt,{id:t.id,username:t.username,commentCount:y,close:()=>E(!1)})}),a("div",{className:"video","data-active":f,onClick:R,children:[k&&e("div",{className:"popup-heart","data-visible":k,children:e(xe,{})}),q&&e("div",{className:"paused",children:e(Oe,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!f,ref:w,onTimeUpdate:C=>{var G,j;f&&(C.target.currentTime<p.current&&((G=t==null?void 0:t.music)!=null&&G.path&&te(),(j=t==null?void 0:t.metadata)!=null&&j.ttsUrl&&(I.current.currentTime=0,I.current.play().catch(()=>m("warning","TTS failed to play")))),p.current=C.target.currentTime)},onLoadedMetadata:C=>{var G;f&&(C.currentTarget.volume=((G=r==null?void 0:r.sound)==null?void 0:G.volume)!==void 0?r.sound.volume:.5)}}),a("div",{className:"video-info",children:[a("div",{className:"user",children:[a("div",{className:"username",onClick:()=>{if(!h)return N.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(me,{})]}),a("span",{children:[" â€¢ ",Ce(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((ae=t==null?void 0:t.music)==null?void 0:ae.title)&&a("div",{className:"song",children:[e(Qe,{})," ",t.music.artist," - ",t.music.title]})]}),a("div",{className:"video-actions",children:[e(Z,{className:"profile",avatar:t.avatar,onClick:C=>{if(C.stopPropagation(),!h)return N.fetchAndSetProfile(t.username)}}),a("div",{className:"action","data-active":s,onClick:C=>{C.stopPropagation(),J()},children:[e(Ae,{className:"like"}),Y(S)]}),a("div",{className:"action",onClick:C=>{C.stopPropagation(),E(!0)},children:[e(Ye,{className:"comment"}),Y(y)]}),a("div",{className:"action",onClick:C=>{C.stopPropagation(),A()},"data-active":b,children:[e(Ge,{className:"save"}),Y(D)]}),e("div",{className:"action",onClick:C=>{C.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(o==null?void 0:o.username)===t.username?e(et,{className:"manage"}):a(Q,{children:[e(Ft,{className:"share"}),i("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e(tt,{src:(ne=t==null?void 0:t.music)==null?void 0:ne.cover,fallback:"./assets/img/icons/music/unknown.png"})})]})]})]})}function _e(){var se;const{View:t,Profile:f,FeedData:h,Func:P,GoBack:N}=l.useContext(B),T=fe(ce.Settings),[d,r]=t,[o,g]=h,[n,s]=N,[u,b]=l.useState(0),[V,U]=l.useState(!1),[c,S]=l.useState(!1),[v,D]=l.useState("recent"),[F,y]=l.useState([]),[K,O]=l.useState(0),E=fe(ge),w=l.useRef(null);l.useEffect(()=>{var M;if(oe("TikTok")){if(d!=="feed"){I.current=!0;return}return b(0),S(!1),U(!1),y([]),(M=o==null?void 0:o.args)!=null&&M.single?(y([o.video]),O(0),p.current=0):L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:v,...o==null?void 0:o.args}},$.Videos).then(H=>{if(!H)return m("warning","No videos found");H.length<5&&S(!0),o&&(o!=null&&o.video)&&H.unshift(o.video),O(0),p.current=0,y(H)}),()=>{g(null)}}},[d]),l.useEffect(()=>{if(oe("TikTok")&&d==="feed")return setTimeout(()=>{ce.Styles.TextColor.set("#ffffff")},100),()=>{ce.Styles.TextColor.set(T.display.theme==="dark"?"#ffffff":"#000000"),ce.SoundManager.reset()}},[d,E==null?void 0:E.active]);const I=l.useRef(!0);l.useEffect(()=>{if(oe("TikTok")&&!o){if(I.current){I.current=!1;return}y([]),L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:v}},$.Videos).then(M=>{if(!M)return m("warning","No videos found");M.length<5&&S(!0),y(M),p.current=0,O(0)})}},[v,o]);const _=l.useRef(!1),p=l.useRef(0);l.useEffect(()=>{p.current=0,O(0),b(0),S(!1),U(!1)},[v]),l.useEffect(()=>{if(oe("TikTok")){if(F.length===0)return m("info","No videos found");if(F.length===1||F.length-2===K){if(m("info","fetching more videos: "+JSON.stringify(o)),o!=null&&o.single)return;if(V||c)return m("info","Already fetching or fetched everything");U(!0),L("TikTok",{action:"getVideos",page:u+1,data:{full:!0,type:v,...o==null?void 0:o.args}},null).then(M=>{M&&M.length>0?(M.length<5&&S(!0),y(H=>[...H,...M]),U(!1)):(m("info","Fetched everything"),U(!1),S(!0)),b(H=>H+1)})}}},[K]),l.useEffect(()=>{if(!F||F.length===0)return;const M=()=>{if(!_.current)return requestAnimationFrame(M);_.current=!1;const R=w.current,ae=document.querySelector(".video").getBoundingClientRect().height,ne=p.current*ae;m("info",`Target scroll position: ${ne}, current scroll position: ${R.scrollTop}, snapIndex: ${p.current}`),R.scrollTo({top:ne,behavior:"smooth"}),O(p.current),requestAnimationFrame(M)};requestAnimationFrame(M);const H=R=>{var X,ae;R.preventDefault(),!((ae=(X=Be)==null?void 0:X.value)!=null&&ae.visible)&&k(R)},te=["ArrowUp","ArrowDown","Space"],J=R=>{var X;(te.includes(R.key)||te.includes(R.code))&&!document.querySelector(".tiktok-content")&&((X=E==null?void 0:E.active)==null?void 0:X.name)==="TikTok"&&R.preventDefault(),(R.key==="ArrowUp"||R.key==="ArrowDown")&&x(R.key==="ArrowUp"?-1:1)},A=w.current;return A.addEventListener("wheel",H,{passive:!1}),window.addEventListener("keydown",J),()=>{m("info","Removing event listeners (space button)"),A.removeEventListener("wheel",H),window.removeEventListener("keydown",J)}},[F]);const k=M=>{if(M.preventDefault(),ee())return;const te=M.deltaY<0?-1:1;x(te)},x=M=>{const te=F.length-1,J=p.current+M;J>=0&&J<=te?(p.current=J,_.current=!0,m("info","Scrolling to video: "+p.current)):J<0?m("info","Top of the feed, trying to scroll up?"):m("info","Reached the bottom of the feed")},q=M=>{M.button===1&&M.preventDefault()},ee=()=>!!document.querySelector(".comments-container");let z=d==="feed";return e("div",{className:"tiktok-feed",style:{visibility:z?"visible":"hidden"},children:a(re.div,{className:"feed-wrapper",...We("right",d),children:[!o&&e("div",{className:"feed-header",children:a("div",{className:"feed-header-content",children:[e("div",{className:le("item",v=="following"&&"active"),onClick:()=>D("following"),children:i("APPS.TIKTOK.FOLLOWING")}),e("div",{className:le("item",v=="recent"&&"active"),onClick:()=>D("recent"),children:i("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":v==="recent"?"right":"left"})]})}),v==="following"&&F.length===0&&e("div",{className:"no-following",children:i("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((se=o==null?void 0:o.args)==null?void 0:se.username)||(n==null?void 0:n.view))&&e(ve,{className:"go-back",onClick:()=>{g(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(r(n.view),s(null)):P.fetchAndSetProfile(o.args.username)}}),e("div",{className:"videos",ref:w,onMouseDown:q,children:F==null?void 0:F.map((M,H)=>e(ke,{data:M,active:K===F.indexOf(M)&&z},H))})]})})}function yt(){const{User:t,LoggedIn:f,View:h}=l.useContext(B),[P,N]=t,[T,d]=f,[r,o]=h,[g,n]=l.useState("login"),[s,u]=l.useState(null),[b,V]=l.useState(!0),U=()=>{var S;if(b)return m("warning","Button is disabled");if(!s)return m("warning","No form data");let c=(S=s==null?void 0:s.username)==null?void 0:S.toLowerCase().replace(/\s/g,"");if(g==="signup"){let v=c.match(he.value.UsernameFilter);if(!v||(v==null?void 0:v[0])!==c||c.length<3||c.length>15){m("warning","Username did not match regex"),W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});return}}L("TikTok",{action:g,data:s}).then(v=>{var D,F,y,K,O,E;if(!v)return m("warning","Could not login, no response");if(v.success){let w={...v.data,username:((D=v.data)==null?void 0:D.username)??c,name:((F=v.data)==null?void 0:F.username)??(s==null?void 0:s.name),follower_count:((y=v.data)==null?void 0:y.follower_count)||0,following_count:((K=v.data)==null?void 0:K.following_count)||0,like_count:((O=v.data)==null?void 0:O.like_count)||0};N(w),d(!0),o("feed"),ie.APPS.TIKTOK.account.set(w)}else{if(v.error)return W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i(`APPS.INSTAGRAM.${(E=v.error)==null?void 0:E.toUpperCase()}`),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});m("info",`Could not login, ${v.error}`)}})};return l.useEffect(()=>{var c,S;s&&V(g==="login"?!s.username||!s.password:!s.name||!s.username&&((c=s.username)==null?void 0:c.length)<3||!s.password&&((S=s.password)==null?void 0:S.length)<3)},[s]),a("div",{className:"login-container",children:[a("div",{className:"login-header",children:[e("div",{className:"title",children:g==="login"?i("APPS.TIKTOK.LOGIN_TITLE"):i("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:g==="login"?i("APPS.TIKTOK.LOGIN_SUBTITLE"):i("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),a("div",{className:"login-body",children:[g==="signup"&&e(ue,{placeholder:i("APPS.TIKTOK.NAME"),onChange:c=>{c.target.value.length>30||u({...s,name:c.target.value})}}),e(ue,{placeholder:i("APPS.TIKTOK.USERNAME"),onChange:c=>{c.target.value.length>20||u({...s,username:c.target.value.toLowerCase()})}}),e(ue,{type:"password",placeholder:i("APPS.TIKTOK.PASSWORD"),onChange:c=>{c.target.value.length>50||u({...s,password:c.target.value})}}),e("div",{className:"login-button","data-disabled":b,onClick:U,children:g==="login"?i("APPS.TIKTOK.LOGIN"):i("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:g==="login"?a(Q,{children:[i("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:i("APPS.TIKTOK.SIGNUP")})]}):a(Q,{children:[i("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:i("APPS.TIKTOK.LOGIN")})]})})]})}function Rt(){const{User:t,Profile:f,View:h,LoggedIn:P,UserPanel:N,Func:T,GoBack:d,Dm:r}=l.useContext(B),[o,g]=t,[n,s]=f,[u,b]=P,[V,U]=N,[c,S]=d,[v,D]=r,[F,y]=h,[K,O]=l.useState([]),[E,w]=l.useState(!1),[I,_]=l.useState("recent"),[p,k]=l.useState((n==null?void 0:n.follower_count)||0),[x,q]=l.useState((n==null?void 0:n.following_count)||0),ee=[{value:"recent",icon:e(nt,{})},{value:"liked",icon:n!=null&&n.show_likes?e(xe,{}):e(it,{})},{value:"saved",hidden:(o==null?void 0:o.username)!==(n==null?void 0:n.username),icon:e(Ge,{})}],z=[{label:i("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:i("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:i("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];l.useEffect(()=>{oe("TikTok")&&n&&(k((n==null?void 0:n.follower_count)||0),q((n==null?void 0:n.following_count)||0),O([]),!(I==="liked"&&!(n!=null&&n.show_likes)&&o.username!==n.username)&&L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:I},page:0},$.Videos.filter(A=>A.username===n.username)).then(A=>{if(!A)return m("warning","Failed to get videos");O(A)}))},[I,n==null?void 0:n.username]);const{handleScroll:se}=Se({fetchData:A=>L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:I},page:A}),onDataFetched:A=>O(R=>[...R,...A]),perPage:25}),M=A=>{L("TikTok",{action:"toggleFollow",data:{username:n.username,follow:A}},{success:!0}).then(R=>{if(!R||!(R!=null&&R.success))return m("warning","Failed to toggle follow");if(R.error)return m("error",R.error);m("info",`Toggling follow to ${A}`),s({...n,isFollowing:A})})};de("tiktok:updateFollowers",A=>{if(!A||A.username!==n.username)return;let R=p+(A.method==="add"?1:-1);s({...n,follower_count:R}),k(R)}),de("tiktok:updateFollowing",A=>{if(!A||A.username!==n.username)return;let R=x+(A.method==="add"?1:-1);s({...n,following_count:R}),q(R)});const H=()=>{o.username===n.username&&L("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(A=>{var ae;if(!A)return m("info","No accounts found");let R=o.isAdmin,X=(ae=A==null?void 0:A.filter(ne=>ne!==o.username))==null?void 0:ae.map(ne=>({title:ne,cb:()=>{ne!==o.username&&L("AccountSwitcher",{action:"switch",app:"TikTok",account:ne}).then(()=>{L("TikTok",{action:"isLoggedIn"}).then(C=>{C?(ie.APPS.TIKTOK.account.set(C),g({...C,isAdmin:R}),y("feed"),b(!0)):ie.APPS.TIKTOK.account.set(null)})})}}));W.ContextMenu.set({buttons:[...X,{title:i("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{b(!1)}}]})})},te=A=>{g(A),s(A),w(!1)},J=()=>{o.username!==n.username&&L("TikTok",{action:"getChannelId",username:n.username}).then(A=>{D({id:A.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),S({view:"profile",data:{identifier:"profile",data:n}}),y("dm"),s(null)})};return n?a(Q,{children:[e(Pe,{children:E&&e(Mt,{close:A=>te(A)})}),a(re.div,{className:"profile-container",children:[a("div",{className:"profile-header",children:[n.username===o.username?e("span",{}):e("div",{children:e(ve,{className:"go-back",onClick:()=>{var A,R;if(c!=null&&c.view){if(c!=null&&c.data)switch((A=c==null?void 0:c.data)==null?void 0:A.identifier){case"dm":D((R=c==null?void 0:c.data)==null?void 0:R.data),y("dm");break;default:y("feed"),s(null)}else y(c==null?void 0:c.view);S(null)}else y("feed");s(null)}})}),a("div",{className:"name",onClick:H,children:[n.name,o.username===n.username&&e(Me,{})]}),e("span",{})]}),a("div",{className:"profile-info",onScroll:se,children:[e("div",{className:"avatar",children:e(Z,{avatar:n.avatar})}),a("div",{className:"username",children:["@",n.username,n.verified&&e(me,{})]}),e("div",{className:"stats",children:z.map((A,R)=>{let X={followers:p,following:x};return a("div",{className:"item","data-cursor":A.name!==void 0,onClick:()=>{A.name&&U({value:A.name,username:n.username,following:x,followers:p})},children:[e("div",{className:"value",children:Y(X[A.name]??n.like_count)}),e("div",{className:"label",children:A.label})]},R)})}),a("div",{className:"actions",children:[o.username===n.username?e("div",{className:"button big",onClick:()=>w(!0),children:i("APPS.TIKTOK.EDIT_PROFILE")}):e(Q,{children:n.isFollowing?a(Q,{children:[e("div",{className:le("button","big"),onClick:J,children:i("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>M(!1)}]})},children:e(st,{})})]}):a(Q,{children:[e("div",{className:"button follow",onClick:()=>M(!0),children:i("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:J,children:e(Re,{})})]})}),n.instagram&&e("div",{className:"button instapic",onClick:()=>{ge.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button birdy",onClick:()=>{ge.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),a("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:ee.filter(A=>!A.hidden).map(A=>e("div",{className:le("item",I===A.value&&"active"),onClick:()=>_(A.value),children:A.icon}))}),a("div",{className:"feed",children:[I==="liked"&&!(n!=null&&n.show_likes)&&o.username!==n.username&&a("div",{className:"private",children:[e("div",{className:"title",children:i("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:i("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),K.map((A,R)=>e(Vt,{data:A,onClick:()=>{S({...c,ignoreFeed:!0}),T.fetchAndSetVideo(A.id,{username:n.username,id:A.id,type:I})}}))]})]})]})]})]}):null}const Vt=({data:t,onClick:f})=>a("div",{className:"item",onClick:f,children:[e("video",{src:t.src,loop:!0,onMouseEnter:h=>{var P;return(P=h.currentTarget)==null?void 0:P.play().catch(()=>m("warning","Failed to play video"))},onMouseLeave:h=>{var P;return(P=h.currentTarget)==null?void 0:P.pause()},muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),a("div",{className:"views",children:[e(De,{}),Y(t.views)]})]}),Mt=t=>{var u,b,V,U,c,S;const{User:f,LoggedIn:h,View:P}=l.useContext(B),[N,T]=f,[d,r]=h,[o,g]=l.useState(null),n=["instagram","twitter"];l.useEffect(()=>{g({name:N.name,bio:N.bio,avatar:N.avatar,instagram:N.instagram,twitter:N.twitter,show_likes:N.show_likes})},[]);const s=()=>{L("TikTok",{action:"updateProfile",data:o},{success:!0}).then(v=>{if(!v)return m("warning","No response from server");if(v.success)ie.APPS.TIKTOK.account.set({...N,...o}),t.close({...N,...o});else switch(m("error",v.error),v.error){case"invalid_twitter":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.TWITTER.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.INSTAGRAM.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return a(re.div,{...pe,className:"edit-profile-container",children:[a("div",{className:"edit-profile-header",children:[e("div",{children:e(ve,{onClick:s})}),e("div",{className:"title",children:i("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),a("div",{className:"edit-profile-content",children:[a("div",{className:"avatar",children:[a("div",{className:"image",onClick:()=>{var v,D,F;return W.Gallery.set({allowExternal:(F=(D=(v=he)==null?void 0:v.value)==null?void 0:D.AllowExternal)==null?void 0:F.Trendy,onSelect:y=>g({...o,avatar:y.src})})},children:[e(Z,{avatar:o==null?void 0:o.avatar}),e(at,{})]}),i("APPS.TIKTOK.CHANGE_PHOTO")]}),a("div",{className:"form",children:[a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.NAME")}),e(ue,{type:"text",defaultValue:o==null?void 0:o.name,onChange:v=>{v.target.value.length<=30&&g({...o,name:v.target.value})}})]}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.USERNAME")}),e(ue,{type:"text",disabled:!0,value:N.username})]}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.BIO")}),e($e,{placeholder:i("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:o==null?void 0:o.bio,onChange:v=>{v.target.value.length<=150&&g({...o,bio:v.target.value})}})]}),e("div",{className:"break"}),n.map((v,D)=>a("div",{className:"item",children:[e("div",{className:"label",children:Ee(v)}),e("div",{className:"value",onClick:()=>{o!=null&&o[v]?W.PopUp.set({title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)}),description:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)}),buttons:[{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{g({...o,[v]:null})}}]}):L("AccountSwitcher",{action:"getAccounts",app:Ee(v)}).then(F=>{F||m("info","No accounts found");let y=(F==null?void 0:F.map(K=>({title:K,cb:()=>{g({...o,[v]:K})}})))??[];W.ContextMenu.set({buttons:[...y]})})},children:o!=null&&o[v]?`@${o==null?void 0:o[v]}`:i("APPS.TIKTOK.ADD_ACCOUNT").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)})})]},D)),e("div",{className:"break"}),a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.SHOW_LIKES")}),e(It,{checked:o==null?void 0:o.show_likes,onChange:()=>{g({...o,show_likes:!(o!=null&&o.show_likes)})}})]})]}),a("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"logout"},!0).then(v=>{if(!v)return m("warning","Failed to logout");ie.APPS.TIKTOK.account.set(null),r(!1)})}}]})},children:i("APPS.TIKTOK.LOGOUT")}),((V=(b=(u=he)==null?void 0:u.value)==null?void 0:b.ChangePassword)==null?void 0:V.Trendy)&&e("div",{className:"button red",onClick:()=>ot("TikTok",()=>{}),children:i("APPS.TIKTOK.CHANGE_PASSWORD")}),((S=(c=(U=he)==null?void 0:U.value)==null?void 0:c.DeleteAccount)==null?void 0:S.Trendy)&&e("div",{className:"button red",onClick:()=>{lt("TikTok",()=>{r(null),T(null),ie.APPS.TIKTOK.account.set(null)})},children:i("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function xt(){var c,S,v,D,F,y,K;const{View:t,User:f}=l.useContext(B),[h]=f,[P,N]=t,[T,d]=l.useState(0),[r,o]=l.useState(!1),[g,n]=l.useState("en_us_001"),[s,u]=l.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[b,V]=l.useState(!1);l.useEffect(()=>{V(s.src&&s.caption)},[s]),l.useEffect(()=>{var O,E,w;switch(T){case 0:W.Gallery.set({allowExternal:(w=(E=(O=he)==null?void 0:O.value)==null?void 0:E.AllowExternal)==null?void 0:w.Trendy,includeVideos:!0,includeImages:!1,onSelect:I=>{u({...s,src:I.src}),d(_=>_+1)}});break}},[T]);const U=()=>{var O,E;L("TikTok",{action:"uploadVideo",data:{src:s.src,caption:s.caption,metadata:((O=s.metadata)==null?void 0:O.ttsUrl)&&s.metadata,music:((E=s.music)==null?void 0:E.path)&&{path:s.music.path,volume:s.music.volume}}},{success:!0}).then(w=>{if(!w||w.error)return m("warning","Failed to upload video, error: "+w.error);if(!w.success)return m("warning","Failed to upload video");N("feed")})};return a("div",{className:"upload-container",children:[r&&e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:((S=(c=ce.Settings)==null?void 0:c.value)==null?void 0:S.display.theme)==="dark"?"#fff":"#000"})}),T!==0&&a(Q,{children:[a("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(T===2)return d(O=>O-1);if(T===1)return N("feed")},children:T===2?i("APPS.TIKTOK.GO_BACK"):i("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:i("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!b,onClick:()=>{if(b){if(T===2)return U();s!=null&&s.metadata.tts?(o(!0),Wt(s.metadata.tts,g).then(O=>{o(!1),u({...s,metadata:{...s.metadata,ttsUrl:O}}),d(E=>E+1)}).catch(O=>{o(!1),W.PopUp.set({title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{d(E=>E+1)}}]})})):d(O=>O+1)}},children:T===1?i("APPS.TIKTOK.PREVIEW"):i("APPS.TIKTOK.SHARE")})]}),a("div",{className:"upload-body",children:[T===1&&a(Q,{children:[e("div",{className:"video-placeholder",children:e("video",{src:s.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),a("div",{className:"form",children:[a("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.CAPTION")}),e(ue,{defaultValue:s.caption,placeholder:i("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:O=>{if(O.target.value.length<=100)return u({...s,caption:O.target.value})}})]}),a("div",{className:"item",children:[a("div",{className:"label",children:[i("APPS.TIKTOK.TTS")," ",a("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),e($e,{defaultValue:(v=s==null?void 0:s.metadata)==null?void 0:v.tts,placeholder:i("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:O=>{if(O.target.value.length<=300)return u({...s,metadata:{...s.metadata,tts:O.target.value}})}}),((D=s==null?void 0:s.metadata)==null?void 0:D.tts)&&e("select",{onChange:O=>n(O.target.value),children:(y=(F=he)==null?void 0:F.value.TikTokTTS)==null?void 0:y.map(O=>e("option",{value:O[1],selected:O[1]===g,children:O[0]}))})]}),a("div",{className:"item",children:[a("div",{className:"label",children:[i("APPS.TIKTOK.MUSIC")," ",a("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),a("div",{className:"button",onClick:()=>W.MusicSelector.set({onSelect:O=>u({...s,music:{...s.music,...O}})}),children:[s.music?s.music.title:i("APPS.TIKTOK.SELECT_MUSIC"),e(we,{onClick:O=>{O.stopPropagation(),u({...s,music:null})}})]}),((K=s.music)==null?void 0:K.title)&&a("div",{className:"slider",children:[e(rt,{}),e(Nt,{min:0,max:.5,step:.025,value:s.music.volume!==void 0?s.music.volume:.25,onChange:O=>u({...s,music:{...s.music,volume:O}})}),e(ct,{})]})]})]})]}),T===2&&e("div",{className:"preview",children:e(ke,{data:{...s,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:h.username,avatar:h.avatar??`./assets/img/avatar-placeholder-${ce.Settings.value.display.theme}.svg`,verified:h.verified,music:s.music},active:!0,preview:!0})})]})]})]})}const Gt=async(t,f,h)=>{const P=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:f,voice:h})});if(!P.ok)throw new Error(`Fetch error: ${P.status} ${P.statusText}`);return P.json()},Bt=async(t,f)=>{const h=await Gt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,f);if(h.success&&h.data)return h.data;throw h},Wt=async(t,f)=>{try{const h=await Bt(t,f),N=await(await fetch(`data:application/octet-stream;base64,${h}`)).arrayBuffer(),T=new Uint8Array(N),d=new Blob([T],{type:"audio/mp3"});return await dt("Audio",d)}catch(h){throw h}};function Ht(){const{View:t,User:f,Profile:h,FeedData:P}=l.useContext(B),[N,T]=f,[d,r]=t,[o,g]=h,[n,s]=P,u=[{value:"feed",label:i("APPS.TIKTOK.HOME"),activeIcon:e(ut,{}),icon:e(mt,{}),cb:()=>{r("feed"),s(null)}},{value:"discover",label:i("APPS.TIKTOK.DISCOVER"),activeIcon:e(ft,{}),icon:e(ht,{})},{value:"upload",label:i("APPS.TIKTOK.UPLOAD"),activeIcon:e(Le,{}),icon:e(Le,{})},{value:"inbox",label:i("APPS.TIKTOK.INBOX"),activeIcon:e(vt,{}),icon:e(Ve,{})},{value:"profile",label:i("APPS.TIKTOK.PROFILE"),activeIcon:e(Tt,{}),icon:e(Pt,{}),cb:()=>{g(N),r("profile")}}];return e("div",{className:"tiktok-footer","data-feed":d==="feed",children:u.map((b,V)=>{let U=d===b.value;return a("div",{className:"item","data-active":U,onClick:()=>b.cb?b.cb():r(b.value),children:[U?b.activeIcon:b.icon,b.label]},V)})})}function $t(){const{User:t,ShareComponent:f,View:h}=l.useContext(B),[P]=t,[N,T]=h,[d,r]=f,[o,g]=l.useState([]);l.useState(!1);const[n,s]=l.useState(d==null?void 0:d.pinned);return l.useEffect(()=>{L("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(u=>{if(!(u!=null&&u.success))return m("warning",u.error);g(u.channels.sort((b,V)=>V.timestamp-b.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>r(null),children:a(re.div,{...pe,className:"share-wrapper",onClick:u=>u.stopPropagation(),children:[e("div",{className:"share-header",children:i("APPS.TIKTOK.SHARE_TITLE")}),a("div",{className:"share-body",children:[e("div",{className:"friends",children:o.map(u=>e(Zt,{data:{username:u.username,name:u.name,avatar:u.avatar,verified:u.verified}}))}),a("div",{className:"options",children:[a("div",{className:"item",children:[e(gt,{}),i("APPS.TIKTOK.REPORT")]}),P.username===(d==null?void 0:d.username)&&a(Q,{children:[a("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?i("APPS.TIKTOK.UNPIN"):i("APPS.TIKTOK.PIN")}),buttons:[{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{L("TikTok",{action:"togglePinnedVideo",id:d==null?void 0:d.id,toggle:!n},{success:!0}).then(u=>{if(u!=null&&u.success||m("warning",u.error),u!=null&&u.error&&u.error==="max_pinned")return W.PopUp.set({title:i("APPS.TIKTOK.MAX_PINNED_TITLE"),description:i("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.OK")}]});s(!n)})}}]})},children:[e(pt,{}),n?i("APPS.TIKTOK.UNPIN_VIDEO"):i("APPS.TIKTOK.PIN_VIDEO")]}),a("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"deleteVideo",id:d==null?void 0:d.id},{success:!0}).then(u=>{u!=null&&u.success||m("warning",u.error),r(null),T("profile")})}}]})},children:[e(St,{}),i("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>r(null),children:i("APPS.TIKTOK.CANCEL")})]})})}const Zt=t=>{const{ShareComponent:f}=l.useContext(B),[h]=f,[P,N]=l.useState(!1);return a("div",{className:"item","data-sent":P,onClick:()=>{if(P)return m("warning","You have already sent this video to this user!");L("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${h.src}"ID="${h.id}"!>`}},{success:!0}).then(d=>{if(!(d!=null&&d.success))return m("warning",d.error);m("info","Successfully sent video to user!"),N(!0)})},children:[e(Z,{avatar:t.data.avatar}),e("div",{className:"name",children:t.data.name}),P&&e(be,{className:"checkmark"})]})};function Yt(){const{UserPanel:t}=l.useContext(B),[f,h]=t,[P,N]=l.useState([]),[T,d]=l.useState(f==null?void 0:f.value),r={following:"getFollowing",followers:"getFollowers"},o={following:i("APPS.TIKTOK.FOLLOWING"),followers:i("APPS.TIKTOK.FOLLOWERS")},g=(s,u)=>{var V,U;return(s===i("APPS.TIKTOK.FOLLOWING")?(V=$.Accounts[u])==null?void 0:V.following:((U=$.Accounts[u])==null?void 0:U.followers)??[]).map(c=>$.Accounts[c])};l.useEffect(()=>{!f||!(f!=null&&f.value)||T&&L("TikTok",{action:r[T],username:f.username,page:0},g(r[T],f.username)).then(s=>{if(!s)return m("warning","No data returned from tiktok event");N(s)})},[T]);const{handleScroll:n}=Se({fetchData:s=>L("TikTok",{action:r[f.value],username:f.username,page:s}),onDataFetched:s=>N([...P,...s]),perPage:15});return a(re.div,{...pe,className:"userpanel-container",children:[a("div",{className:"userpanel-header",children:[e("div",{onClick:()=>h(null),children:e(ve,{})}),e("div",{className:"title",children:f==null?void 0:f.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(s=>a("div",{className:"item","data-active":T===s,onClick:()=>d(s),children:[o[s]," ",Y(f==null?void 0:f[s])??0]}))}),e("div",{className:"userpanel-content",onScroll:n,children:P.map((s,u)=>e(qt,{data:s}))})]})}const qt=({data:t})=>{const{Func:f,UserPanel:h}=l.useContext(B),[P,N]=h,[T,d]=l.useState(t.isFollowing),r=o=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:o}}).then(g=>{if(!g||!(g!=null&&g.success))return m("warning","Failed to toggle follow");if(g.error)return m("error",g.error);d(o)})};return a("div",{className:"item",onClick:()=>{f.fetchAndSetProfile(t.username),N(null)},children:[a("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),a("div",{className:"user",children:[a("div",{className:"name",children:[t.name," ",t.verified&&e(me,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:le("button",T?"following":"follow"),onClick:o=>{o.stopPropagation(),T?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:T?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})};const B=l.createContext(null);function Qt(){const t=fe(ce.Settings),[f,h]=l.useState(null),[P,N]=l.useState("feed"),[T,d]=l.useState(null),[r,o]=l.useState(null),[g,n]=l.useState(null),[s,u]=l.useState(null),[b,V]=l.useState(null),[U,c]=l.useState(null),[S,v]=l.useState(!1),[D,F]=l.useState(null),[y,K]=l.useState(!0),[O,E]=l.useState(!0);l.useEffect(()=>{L("isAdmin",null,!1).then(p=>{if(ie.APPS.TIKTOK.account.value){h({...ie.APPS.TIKTOK.account.value,isAdmin:p}),v(!0),K(!1);return}else if(ie.APPS.TIKTOK.account.value===!1)return K(!1);L("TikTok",{action:"isLoggedIn"},$.Account).then(k=>{k?(ie.APPS.TIKTOK.account.set(k),h({...k,isAdmin:p}),v(!0),K(!1)):(ie.APPS.TIKTOK.account.set(!1),K(!1))})})},[]),l.useEffect(()=>{P==="feed"&&T||P==="profile"&&(T==null?void 0:T.username)!==f.username?E(!1):E(!0)},[T]);const w={profile:e(Rt,{}),video:e(ke,{}),discover:e(Ot,{}),inbox:e(Lt,{}),messages:e(kt,{}),dm:e(bt,{}),upload:e(xt,{}),feed:e(_e,{})},I=p=>{if(!p)return m("warning","Couldn't fetch profile (no username provided)");m("info",`Fetching profile ${p}`),L("TikTok",{action:"getProfile",username:p},$.Accounts.find(k=>k.username===p)).then(k=>{if(!k)return m("warning","Couldn't fetch profile");d(k),N("profile")})},_=(p,k)=>{L("TikTok",{action:"getVideo",id:p},{video:$.Videos.find(x=>x.id===p)}).then(x=>{if(!x)return m("warning","Couldn't fetch video");if(x.error)return m("warning",x.error);if(!(x!=null&&x.video))return m("warning","Couldn't fetch video");V({video:x.video,args:k}),N("feed")})};return e(B.Provider,{value:{User:[f,h],View:[P,N],Profile:[T,d],LoggedIn:[S,v],FeedData:[b,V],UserPanel:[g,n],ShareComponent:[s,u],GoBack:[U,c],Video:[D,F],Dm:[r,o],Func:{fetchAndSetProfile:I,fetchAndSetVideo:_}},children:y||!Ct()?e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":P==="feed",children:S===!0?a(Q,{children:[a("div",{className:"tiktok-wrapper","data-profile":!O,children:[e(_e,{}),P!=="feed"&&e(re.div,{...We(P=="discover"||P=="messages"?"right":"left",P),className:"tiktok-content",children:w==null?void 0:w[P]}),e(Pe,{children:g&&e(Yt,{})})]}),e(Pe,{children:s&&e($t,{})}),O&&e(Ht,{})]}):e(yt,{})})})}const Ce=t=>{if(!t)return;const f=new Date(t),P=new Date().getTime()-f.getTime(),N=Math.floor(P/(1e3*3600*24)),T=Math.floor(P/(1e3*3600)),d=Math.floor(P/(1e3*60)),r=Math.floor(P/1e3);return N>0?`${f.getMonth()+1}-${f.getDate()}`:T>0?`${T}h`:d>0?`${d}m`:r>0?`${r}s`:i("NOW")};function Y(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,Qt as default,Ce as formatDate,Y as formatNumber};
